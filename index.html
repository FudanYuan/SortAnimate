<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>排序算法动画演示</title>
	<link rel="stylesheet" href="css/style.css" />
	<script type="text/javascript" src="js/SortAnimate.js"></script>
</head>
<body>
	<div style="margin:50px;">
		<h1>排序算法动画演示 <small><a href="https://github.com/jun-lu/SortAnimate">view Github</a></small></h1>
		
		<div>
			<p>
			动画速度：<input value="170" max="200" min="1" id="speed" type="range" onchange="srotanimte && srotanimte.changeSpeed(200-this.value)" >
			</p>
			<p>
			数组长度：<input value="50" width="50" id="arrlen"> <input type="button" value="随即数组" onclick="arrayText(document.getElementById('arrlen').value)" class="btn" />
			</p>
			<p>
			待排序数组：<input id="arrayText" value="[43,27,39,17,32,21,14,42,22,15,18,12,46,1,16,10,4,29,3,23,24,49,0,5,36,13,34,6,19,47,9,33,31,20,28,44,38,37,41,40,8,35,30,7,11,45,2,25,48,26]" style="width:80%;">
			</p>
			<p></p>
		</div>
		<div>
		
			<input type="button" value="冒泡排序" onclick="bubbleSortStart()" class="btn" />
			<input type="button" value="快速排序" onclick="quickSortStart()" class="btn" />
			<input type="button" value="插入排序" onclick="insertSortStart()" class="btn" />
			<input type="button" value="希尔排序" onclick="shellSortStart()" class="btn" />
			<input type="button" value="选择排序" onclick="selectionSortStart()" class="btn" />
			<input type="button" value="鸡尾酒排序" onclick="cocktailSortStart()" class="btn" />
			<input type="button" value="奇偶排序" onclick="oddEvenSortStart()" class="btn" />
			<input type="button" value="梳排序" onclick="combSortStart()" class="btn" />
			
			
		</div>
		<div>
			<div class="sort-animate-box" id="sortAnimateBox" style="height:100px;"></div>
			<div id="sortText"></div>
		</div>
		
	</div>
	<script type="text/javascript">
	
		var srotanimte = null;
		
		function getSpeed(){
			return 200-document.getElementById('speed').value;
		}
		function $(id){
			return document.getElementById(id);//.value;
		}
		
		function arrayText( len ){
			len = len || 50;
			var arr = [];
			for(var i=0; i<len;i++){
				arr.push( i );
			}
			arr.sort(function(){
				return Math.random() - 0.5;
			});
			document.getElementById( "arrayText" ).value = "["+ arr.toString() +"]";
		};
		
		function getArray(){
			var text = document.getElementById( "arrayText" ).value;
			try{
				return JSON.parse( text );
			}catch(e){
				alert("数组有错误")
			}
		}
		
		function bubbleSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "冒泡排序";
			bubbleSort(arr, srotanimte);
			srotanimte.play(getSpeed());
		}
		
		function quickSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "快速排序";
			quickSort(arr, srotanimte);
			srotanimte.play(getSpeed())
		}

		function insertSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "插入排序";
			insertSort(arr, srotanimte)
			srotanimte.play(getSpeed())
		}
		
		function shellSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "希尔排序";
			shellSort(arr, srotanimte)
			srotanimte.play(getSpeed())
		}
		
		function selectionSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "选择排序";
			selectionSort(arr, srotanimte)
			srotanimte.play(getSpeed())
		}
		
		
		function cocktailSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "鸡尾酒排序";
			cocktailSort(arr, srotanimte);
			srotanimte.play(getSpeed())
		}
		
		function oddEvenSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "奇偶排序";
			oddEvenSort(arr, srotanimte);
			srotanimte.play(getSpeed());
		}
		
		function combSortStart(){
			var arr = getArray().slice()
			srotanimte = new SortAnimate( arr, $('sortAnimateBox') )
			$('sortText').innerHTML = "梳排序";
			combSort(arr, srotanimte);
			srotanimte.play(getSpeed());
			
		}
		
		//冒泡
		function bubbleSort(array, srotanimte){
			var i = 0, len = array.length,
				j, d;
			for(; i<len; i++){
				srotanimte.activeOne(i);
				for(j=0; j<len; j++){
					srotanimte.activeOne(j);
					if(array[i] < array[j]){
						d = array[j];
						array[j] = array[i];
						array[i] = d;
						srotanimte.exchange(i, j);
					}
					srotanimte.blurOne(j);
				}
				srotanimte.blurOne(i);
			}
			return array;
		};
	
		//快排
		function quickSort(array, srotanimte){
			if(array.length == 0){
				return array;
			}
			var i = 0;
			var j = array.length - 1;
			var Sort = function(i, j){
				
				
				// 结束条件
				if(i == j ){ 
					return; 
				};
				
				srotanimte.activeFragment(i, j)
				
				var key = array[i];
				var stepi = i; // 记录开始位置
				var stepj = j; // 记录结束位置
				//srotanimte.activeOne(i);
				while(j > i){
					srotanimte.activeOne(j);

					// j <<-------------- 向前查找
					if(array[j] >= key){
						srotanimte.blurOne(j);
						j--;
					}else{
						srotanimte.exchange(i, j);
						array[i] = array[j]
						//i++ ------------>>向后查找
						while(j > ++i){
							srotanimte.activeOne(i);
							if(array[i] > key){
								srotanimte.exchange(i, j);
								srotanimte.blurOne(i);
								array[j] = array[i];
								break;
							}
							srotanimte.blurOne(i);
						}
					}
					srotanimte.blurOne(j);
				}
				
				// 如果第一个取出的 key 是最小的数
				srotanimte.blurFragment()
				
				if(stepi == i){
					Sort(++i, stepj);
					return ;
				}
				
				// 最后一个空位留给 key
				array[i] = key;
				
				
				// 递归
				Sort(stepi, i);
				Sort(j, stepj);
			}
			
			Sort(i, j);
			
			return array;
		}
		
		//插入
		function insertSort(array, srotanimte){
		
			var i = 1, j, step, key,
				len = array.length;
			
			for(; i < len; i++){
				//srotanimte.activeOne(i);
				step = j = i;
				key = array[j];
				srotanimte.activeFragment(0, i);
				while(--j > -1){
					srotanimte.activeOne(j);
					if(array[j] > key){
						srotanimte.exchange(j+1, j);
						array[j+1] = array[j];
						srotanimte.blurOne(j);
					}else{
						srotanimte.blurOne(j);
						break;
					}
					srotanimte.blurOne(j);
				}
				//srotanimte.blurOne(i);
				array[j+1] = key;
				srotanimte.blurFragment(0, i);
			}
			
			return array;
		}
	
		//希尔
		function shellSort(array, srotanimte){

			
			var stepArr = [1031612713, 217378076, 45806244, 9651787, 2034035, 428481, 90358, 19001, 4025, 1750, 836, 701, 301, 132, 57, 23, 10, 4, 1]; // reverse() 在维基上看到这个最优的步长 较小数组
			var i = 0;
			var stepArrLength = stepArr.length;
			var len = array.length;
			var len2 =  parseInt(len/2);
			
			for(;i < stepArrLength; i++){
				if(stepArr[i] > len2){
					continue;
				}
				stepSort(stepArr[i]);
			}

			// 排序一个步长
			function stepSort(step){
				
				//console.log(step) 使用的步长统计
				
				var i = 0, j = 0, f, tem, key;
				
				
				for(;i < step; i++){// 依次循环列
					for(j=1; step * j + i < len; j++){//依次循环每列的每行
						tem = f = step * j + i;
						key = array[f];
						srotanimte.activeOne( f );
						while((tem-=step) >= 0){// 依次向上查找
							//console.log(tem);
							srotanimte.activeOne( tem );
							if(array[tem] > key){
								srotanimte.exchange(tem+step, tem);
								array[tem+step] = array[tem];
							}else{
								srotanimte.blurOne( tem );
								break;
							}
							srotanimte.blurOne( tem );
						}
						srotanimte.blurOne( f );
						array[tem + step ] = key;
					}
				}
				
			}
			
			return array;
			
		}
		
		//选择排序
		function selectionSort(array, srotanimte){
			var len = array.length;
			var index = 0;
			var k;
			var item;
			var c;
			for(var i=0; i<len; i++){
				
				item = array[i];
				index = i;
				
				srotanimte.activeOne(i);
				//寻找最小的数位置
				for(j=i+1; j<len;j++){
					srotanimte.activeOne(j);
					if(array[j] < item){
						srotanimte.blurOne(index);
						srotanimte.activeOne(j);
						index = j;
						item = array[j];
					}
					srotanimte.blurOne(j);
				}
				srotanimte.blurOne(i);
				if(index != i){
					srotanimte.blurOne(index);
					srotanimte.exchange(i, index);
					c = array[i];
					array[i] = array[index];
					array[index] = c;
				}
			}
			
			return array;
			
		}
		
		//鸡尾酒
		function cocktailSort(array, srotanimte){
			
			var len = array.length;
			var item = array[0];
			var i = 0;
			var j = len;
			var k=0;
			var index = 0;
			var ischange = false;
			
			while(j - i > 1){
				//寻找最大
				ischange = false;
				item = array[i];
				index = i;
				srotanimte.activeFragment(i, j);
				for(k=i; k<j; k++){
					srotanimte.activeOne(k);
					if(item > array[k]){
						array[index] = array[k];
						array[k] = item;
						ischange = true;
						srotanimte.exchange(index, k);
					}else{
						item = array[k];

					}
					index = k;
					srotanimte.blurOne(k);
				}
				srotanimte.blurFragment(i, j);
				j--;
				
				//寻找最小
				item = array[j];
				index = j;
				srotanimte.activeFragment(i-1, j);
				for(k=j; k>i-1; k--){
					srotanimte.activeOne(k);
					if(item < array[k]){
						array[index] = array[k];
						array[k] = item;
						ischange = true;
						srotanimte.exchange(index, k);
					}else{
						item = array[k];

					}
					index = k;
					srotanimte.blurOne(k);
				}
				srotanimte.blurFragment(i-1, j);
				i++;
				//没有任何交换跳出
				if( ischange == false ){
					break;
				}
			}
			
			return array;
		}
		
		//奇偶
		function oddEvenSort(list, srotanimte){
			var len = list.length;
			var sorted = true;
			
			while(sorted){
				sorted = false;
				
				for(var i = 1; i < len - 1; i += 2)
				{
					srotanimte.activeOne(i);
					srotanimte.activeOne(i+1);
					if(list[i] > list[i + 1])
					{
						var t = list[i];
						list[i] = list[i + 1];
						list[i + 1] = t;
						sorted = true;
						srotanimte.exchange(i, i+1);
					}
					srotanimte.blurOne(i);
					srotanimte.blurOne(i+1);
				}	
				
				for(var i = 0; i < len; i += 2){
				
					srotanimte.activeOne(i);
					srotanimte.activeOne(i+1);
					
					if(list[i] > list[i + 1]){
						var tmp = list[i];
						list[i] = list[i + 1];
						list[i + 1] = tmp;
						sorted = true;
						srotanimte.exchange(i, i+1);
					}
					srotanimte.blurOne(i);
					srotanimte.blurOne(i+1);
				}
			}
			
			return list;
		}

		//梳排序
		function combSort(list, srotanimte){
			var len = list.length;
			var gap = len;
			var swapped = true;
			
			while(gap > 1 || swapped){
				if(gap > 1){
					gap = Math.floor(gap / 1.3); //获取排序间隔
				}
				
				var i = 0;
				swapped = false;
				while(i + gap < len){
					srotanimte.activeOne(i);
					srotanimte.activeOne(i + gap);
					if(list[i] - list[i + gap] > 0){ //如果为正数,交换位置
						var tmp = list[i];
						list[i] = list[i + gap];
						list[i + gap] = tmp;
						swapped = true;
						srotanimte.exchange(i, i + gap);
					}
					srotanimte.blurOne(i);
					srotanimte.blurOne(i + gap);
					i++;
				}				
			}
			
			return list;
		}
				
		//正确性测试
		function test(){
			var arrays = [
				[2,0,1,4,3,5,7,8,6,9],
				[2,4,6,0,1,3,8,5,7,9],
				[0,6,2,4,3,1,8,5,7,9],
				[5,2,0,1,6,7,8,3,4,9],
				[0,6,1,2,3,7,8,5,4,9],
				[0,2,3,8,5,1,7,6,4,9],
				[0,4,1,2,3,6,7,8,9,5],
				[0,1],
				[1,0],
				[0],
				[1],
				[]
			];
			
			console.log("排序正确性测试");
			for(var i=0; i<arrays.length; i++){
				srotanimte = new SortAnimate( arrays[i], $('sortAnimateBox') );
				console.log("冒泡:",bubbleSort(arrays[i], srotanimte));
				console.log("快拍:",quickSort(arrays[i], srotanimte));
				console.log("插入:",insertSort(arrays[i], srotanimte));
				console.log("希尔:",shellSort(arrays[i], srotanimte));
				console.log("选择:",selectionSort(arrays[i], srotanimte));
				console.log("鸡尾酒:",cocktailSort(arrays[i], srotanimte));
				console.log("奇偶:",oddEvenSort(arrays[i], srotanimte));
				console.log("梳排序:",combSort(arrays[i], srotanimte));
				
			}
			console.log("结束");
		}
		//console.log("选择:",cocktailSort([9,1,3,2,4,6,8,5,0,7], srotanimte));
		test();
	</script>
	
	<script type="text/javascript">
		//chat.js
		var __vchat_config = {   
			domain:"https://github.com/jun-lu/SortAnimate",
			topic:"排序算法动画演示",  
			des: "排序算法动画演示,http://jun-lu.github.io/SortAnimate/index.html"  
		};   
		   
		;;(function(){   
			var chat = document.createElement("script");chat.type = 'text/javascript';chat.async = true;   
			chat.src = "http://vchat.co/js/chat.min.js";   
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(chat, s);    
		})();
	</script>
</div>
</body>
</html>